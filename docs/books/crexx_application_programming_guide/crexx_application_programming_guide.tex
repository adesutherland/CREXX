\input{../boilerplate/preamble}

\begin{document}
\renewcommand{\isbn}{978-90-819090-1-3}
\setcounter{tocdepth}{1}
\title{\fontspec{TeX Gyre
    Pagella}\textsc{crexx}\protect\fontspec{Bodoni URW
    Light}\\Application Programming Guide}

\author{The \crexx{} team}
%\date{\null\hfill Version \splice{java org.netrexx.process.NrVersion} of \today}
\date{\null\hfill \today}
\maketitle
\pagenumbering{Roman}
\pagestyle{plain}
\frontmatter
\pagenumbering{Roman}
\pagestyle{plain}
\input{../boilerplate/bookmeta}
\tableofcontents

\newpage
\pagenumbering{arabic}
\frontmatter
\large
\input{../boilerplate/series}
\input{../boilerplate/conventions}

\mainmatter
\input{about}
\part{Guide}
\chapter{Overview of the toolchain}
In the binary distribution of \crexx{} for your platform, the main
toolchain and a number of utilities are included; all programs are statically linked into
their own executable, and no shared object libraries or dll's are needed.\newline
\begin{wrapfigure}{l}{0.4\textwidth}
\includegraphics[scale=0.6]{charts/buildflow.pdf}
\end{wrapfigure}
\fussy
Source can be edited with any text editor\footnote{Vi, Emacs, Xedit,
  VS Code, Eclipse, etc.} of your liking. The sourcefile needs to have an
file extension of \code{.rexx} and contains (Unicode, UTF-8) text. The \code{rxc} \crexx{} compiler
produces a text file which will have a file extension of
\code{.rxas}. The next file in this sequence is produced by the
\code{rxas} assembler and is a binary \code{.rxbin} file. This file is
executable by the \crexx{} \code{rxvme} virtual machine.\newline\newline
\fussy
If you choose to compile a series of \code{*.rxbin} files to a native
executable, the \code{rxcpack} program produces a \code{.c} file,
which can be compiled by any C compiler toolchain.\newline\newline
\fussy
In the following chapters the detailed workflow for the supported platforms is documented.\newline

\chapter{Running \crexx{} on Linux and macOS}
Linux and other Unix-like operating systems like Apple macOS behave in
an identical way when compiling, linking and running a \crexx{}
program.
\input{Running_cRexx}
\chapter{Running \crexx{} on Windows operating systems}
\chapter{Running \crexx{} on VM/370CE}
\chapter{Interlanguage calls}
A \crexx{} program is able to call programs written in the \textsc{Rexx}
language, but also programs native to the platform, using a number of
calling conventions: \[todo: checkrelease\]
\begin{description}
  \item[Address] the \code{address} statement can use the shell and
    I/O indirection to start native executables and provide input, and
    retrieve the output.
    \item[RexxSaa] the traditional RexxSAA calling convention can be
      used for direct interfaces to executables that are designed to
      function as a Rexx library. In its most simple form, these can
      return \textsc{Rexx} strings to the calling program.
      \item[Generic Call Interface] In this RexxSAA extension, the
      type and length of the parameters can be specified by the
      caller\footnote{Which is considered unsafe but sometimes the
        only possibility for programs not designed to be called by \crexx{}}.
\end{description}
\part{Reference}
\chapter{\crexx{} Compiler}
\section{Command Line Options}
\fontspec{IBM Plex Mono}
\begin{shaded}
  \small
  \obeylines \splice{rxc -h | sed "s/&/\and/g"}
 \end{shaded}
\fontspec{TeX Gyre Pagella}
\chapter{\crexx{} Assembler}
\section{Overview}
The purpose of the \crexx{} assembler is to translate a text file with
\emph{rxvm} assembler instructions to a file with binary contents containing these
instructions in their binary, executable form. Its main use is to
translate an \emph{.rxas} file produced by the \crexx{} compiler
\emph{rxc} to a binary \emph{.rxbin} file.

\section{Program Structure}

 Describe the structure of the program, including the main components, how they interact, and any key algorithms or data structures used.

\section{Input/Output}

: Specify the format and structure of any input and output files used by the program, and provide examples of how to use them.

\section{Command Line Arguments}
When the command line argument -h is specified the options are shown:\\
\fontspec{IBM Plex Mono}
\begin{shaded}
  \small
  \obeylines \splice{rxas -h | sed "s/&/\and/g"}
 \end{shaded}
\fontspec{TeX Gyre Pagella}
\section{Assembler Directives}
For machine instructions, see the \emph{\crexx{} VM
  Specification}. This section discusses instructions to the
assembler, which are called \emph{directives} to clearly distinguish
them from virtual machine instruction. These are necessary to pass information into the compiled
\emph{.rxbin} binary file, to enable execution by the \emph{rxvm}
virtual machine.

\section{Examples}

: Provide several examples of how to use the assembler program to
create assembly code, assemble it, and link it into executable code.

\section{In-line assembly}
The \crexx{} compiler \emph{rxc} enables\footnote{In \crexx{} level b} inline assembly through the
\textbf{assembler} statement. When used in this way, a lot of
the complications of the assembly language can be handled by the
\crexx{} compiler, like assigning registers to variables, and the
conversion of datatypes like \emph{integer} for display as \emph{string}.

\lstinputlisting[language=rexx,label=ipow_example,caption=ipow
example.]{examples/pow.rexx}
\fontspec{IBM Plex Mono}
\begin{shaded}
  \small
\splice{rxc examples/pow} \obeylines
\splice{rxas examples/pow} \obeylines \splice{rxvm examples/pow}
 \end{shaded}
\fontspec{TeX Gyre Pagella}

This is a simple and straightforward way to complement the low level
assembler instructions with the power of the \textsc{Rexx}
language. The following example intends to explain how this is
implemented; it can be skipped without consequences.

In this example, the compiler generates the following assembler source:
\lstinputlisting[language=rxas,label=ipow_rxas_example,caption=ipow
rxas example.]{examples/pow.rxas}

The \code{.src} directives indicate where the work is done. The
variables are assigned, as integers, to the registers \code{r1} and
\code{r2}. The line \code{ipow, number, power} becomes \code{ipow
  r3,r1,r2}, and the display on the terminal is handled by the
  \code{itos},\code{sconcat} and \code{say} instructions.

\section{Troubleshooting}

: Include a section on troubleshooting common issues with the assembler program, along with tips for resolving them.

\section{References}

: Provide a list of references used in creating the documentation, such as manuals or online resources for the assembler program, and any other relevant sources.

\chapter{\crexx{} Disassembler}
A disassembler reverses the actions of an assembler; in this case it
delivers a disassembly which in itself can be re-assembled - and still works.

\chapter{\crexx{} Debugger}
\chapter{\crexx{} C Packer}
The C Packer program converts the \emph{.rxbin} files into a C
language structure which links together all needed modules, and a
large part of the Virtual Machine infrastructure, which file then can
be compiled and link edited by the C compiler. GCC and Clang are the
targeted compiler toolchains for Linux, macOS and Windows.
\section{Command Line Options}
\fontspec{IBM Plex Mono}
\begin{shaded}
  \small
  \obeylines \splice{rxcpack -h | sed "s/&/\and/g"}
 \end{shaded}
\fontspec{TeX Gyre Pagella}

\backmatter
\listoftables
%\listoffigures
%\lstlistoflistings
\printindex
\clearpage
\psset{unit=1in}
\begin{pspicture}(3.5,1in)
  \psbarcode{\isbn}{includetext guardwhitespace}{isbn}
\end{pspicture}
\end{document}
